---
title: "The `MidarExperiment` data object"
output: 
  rmarkdown::html_vignette:
    fig_width: 6
    fig_height: 2
description: |
  MiDAR: Postprocessing and Quality Control of Small-Molecule Mass Spectrometry Data 
vignette: >
  %\VignetteIndexEntry{The `MidarExperiment` data object}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, results = FALSE, message = FALSE, comment = "#>", out.width = "100%")
set.seed(1041)
options(dplyr.print_max = 10)
```
# Overview

The `MidarExperiment` object is the main **data container** used in the MiDAR workflow. See 'Data Structure' for more information.

### Creating a MidarExperiment object

```{r}
library(midar)
myexp <- MidarExperiment()
```


### Using MidarExperiment objects

Most `MiDAR` functions take an MidarExperiment object as input. Data processing 
functions return a modified `MidarExperiment`, which can be in subsequent step. 

```{r, results = TRUE, message = TRUE}
myexp <- MidarExperiment()
myexp <- data_load_example(myexp, 1)
myexp <- normalize_by_istd(myexp)

save_dataset_csv(myexp, "mydata.csv", "norm_intensity", FALSE)

```

R pipes can also be used, allowing to chain multiple functions together. This can 
more clearly indicate the processing workflow and make the code more  easier to read. 

```{r, results = TRUE, message = TRUE}
  myexp |> 
  MidarExperiment() |>
  data_load_example(1) |>
  normalize_by_istd() |>
  save_dataset_csv("mydata.csv", "norm_intensity", FALSE)

```

### Multiple `MidarExperiment` objects

Multiple `MidarExperiment` objects can be created and processed independently within the same script.

```{r, results = TRUE}
m_polars <- MidarExperiment(title = "Polar metabolites")
m_lipids <- MidarExperiment(title = "Non-polar metabolites")

```


### Accessing data and metadata

Functions starting with `data_get_` allow to retrieve data and metadat from `MidarExperiment` object. 

```{r, results = TRUE}
myexp <- data_load_example(myexp, 1)
dataset <- get_analyticaldata(myexp, annotated = TRUE)

print(dataset)
```

Alternatively, the `$` syntax can be used access data and metadata tables in `MidarExperiment` objects. 

```{r, results = TRUE}
analyses <- myexp$annot_analyses
features <- myexp$annot_features
  print(features)

```

### Saving and Reading MidarExperiment objects

```{r, results = TRUE}
myexp <- MidarExperiment()
myexp <- data_load_example(myexp, 1)
saveRDS(myexp, file = "myexp-midar.rds", compress = TRUE)
my_saved_exp <- readRDS(file = "myexp-midar.rds")
```
### Status of an `MidarExperiment`

A detailed summary of the dataset and processing status can be printed any time

```{r, results = TRUE}
print(my_saved_exp)
```
