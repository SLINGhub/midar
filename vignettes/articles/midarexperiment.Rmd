---
title: "MidarExperiment object"
output: 
  rmarkdown::html_vignette:
    fig_width: 6
    fig_height: 2
description: |
  MiDAR: Postprocessing and Quality Control of Small-Molecule Mass Spectrometry Data 
vignette: >
  %\VignetteIndexEntry{MidarExperiment object}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, results = FALSE, message = FALSE, comment = "#>", out.width = "100%")
set.seed(1041)
options(dplyr.print_max = 10)
```
# Overview

MidarExperiment` object is the main **data container** used in the MiDAR workflow. It holds all the experimental and processed data and metadata, as well as details of the applied processing steps and the current status of the data.

Most `MiDAR` functions take an `MidarExperiment` object as input. Functions that process or update the data return a modified `MidarExperiment` object as output, allowing it to be used in subsequent functions. You can create and process multiple `MidarExperiment` objects independently within the same script.

### Creating a MidarExperiment object

First the {midar} package is loaded and then we create a new `MidarExperiment` object.

```{r}
library(midar)
myexp <- MidarExperiment()
```


### Using MidarExperiment objects

Most `MiDAR` functions take an MidarExperiment object as input. Functions that process or update the data return a modified `MidarExperiment` object as output, allowing it to be used in subsequent functions. 

```{r, results = TRUE, message = TRUE}
myexp <- MidarExperiment()
myexp <- data_load_example(myexp, 1)
myexp <- normalize_by_istd(myexp)

save_dataset_csv(myexp, "mydata.csv", "norm_intensity", FALSE)

```

You can also use `MidarExperiment` objects in an R pipe chain. This allows you to chain multiple functions together, making your code more streamlined and easier to read while clearly indicating the flow of your processing workflow.

```{r, results = TRUE, message = TRUE}
myexp <- myexp |> 
  MidarExperiment() |>
  data_load_example(1) |>
  normalize_by_istd() |>
  save_dataset_csv("mydata.csv", "norm_intensity", FALSE)

```


### Status of an `MidarExperiment`

A detailed summary of the dataset and processing status can be printed any time

```{r, results = TRUE}
print(myexp)
```

### Multiple `MidarExperiment` objects

Multiple `MidarExperiment` objects can be created and processed independently within the same script.

```{r, results = TRUE}
myexp_1 <- MidarExperiment(title = "Polar metabolites")
myexp_2 <- MidarExperiment(title = "Non-polar metabolites")

#myexp <- midar::combine_experiments(myexp_1, myexp_2)
```


### Accessing data and metadata

Functions starting with `data_get_` allow to retrieve data and metadat from `MidarExperiment` object. 

```{r, results = TRUE}
myexp <- data_load_example(myexp, 1)
dataset <- data_get_analyticaldata(myexp)

print(dataset)
```

Alternatively, the `$` syntax can be used access data and metadata tables in `MidarExperiment` objects. 

```{r, results = TRUE}
analyses <- myexp$annot_analyses
features <- myexp$annot_features
dataset <- myexp$dataset

print(features)

```

### Saving and Reading MidarExperiment objects

```{r, results = TRUE}
myexp <- MidarExperiment()
myexp <- data_load_example(myexp, 1)
saveRDS(myexp, file = "myexp-midar.rds", compress = TRUE)
my_saved_exp <- readRDS(file = "myexp-midar.rds")
print(my_saved_exp)
```

