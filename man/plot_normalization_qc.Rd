% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plots-qc-cv.R
\name{plot_normalization_qc}
\alias{plot_normalization_qc}
\title{Compare Feature Variability Before and After Normalization}
\usage{
plot_normalization_qc(
  data = NULL,
  before_norm_var,
  after_norm_var,
  plot_type,
  qc_types = NA,
  facet_by_class = FALSE,
  y_shared = FALSE,
  filter_data = FALSE,
  include_qualifier = FALSE,
  cv_threshold_value = 25,
  x_lim = c(0, NA_real_),
  y_lim = c(0, NA_real_),
  cols_page = 5,
  point_size = 1,
  point_alpha = 0.5,
  font_base_size = 8
)
}
\arguments{
\item{data}{A \code{MidarExperiment} object}

\item{before_norm_var}{A string specifying the variable from the QC metrics
table to be used for the x-axis (before normalization).}

\item{after_norm_var}{A string specifying the variable from the QC metrics
table to be used for the y-axis (after normalization).}

\item{plot_type}{A character string specifying the type of plot to generate.
Must be one of "scatter", "diff", or "ratio". Selecting "scatter" plots the before and after normalization CV values
as a scatter plot, "diff" plots the difference between the two CV values against the average CV, and "ratio" plots the log2 ratio of the two CV values against the average CV.}

\item{qc_types}{A character vector specifying the QC types to plot. It
must contain at least one element. The default is \code{NA}, which means any
of the non-blank QC types ("SPL", "TQC", "BQC", "HQC", "MQC", "LQC",
"NIST", "LTR") will be plotted if present in the dataset.}

\item{facet_by_class}{If \code{TRUE}, facets the plot by \code{feature_class}, as defined
in the feature metadata.}

\item{y_shared}{Logical; if \code{TRUE}, all facets share the same y-axis scale.
If \code{FALSE} (default), each facet has its own y-axis scale.}

\item{filter_data}{Whether to use all data (default) or only
QC-filtered data (filtered via \code{\link[=filter_features_qc]{filter_features_qc()}}).}

\item{include_qualifier}{Whether to include qualifier features
(default is \code{TRUE}).}

\item{cv_threshold_value}{Numerical threshold value to be shown as dashed
lines in the plot (default is \code{25}).}

\item{x_lim}{Numeric vector of length 2 for x-axis limits. Use \code{NA} for
auto-scaling (default is \code{c(0, NA)}).}

\item{y_lim}{Numeric vector of length 2 for y-axis limits. Use \code{NA} for
auto-scaling (default is \code{c(0, NA)}).}

\item{cols_page}{Number of facet columns per page, representing
different feature classes (default is \code{5}). Only used if
\code{facet_by_class = TRUE}.}

\item{point_size}{Size of points in millimeters (default is \code{1}).}

\item{point_alpha}{Transparency of points (default is \code{0.5}).}

\item{font_base_size}{Base font size in points (default is \code{8}).}
}
\value{
A \code{ggplot2} object representing the scatter plot comparing CV values
before and after normalization.
}
\description{
Evaluates the effectiveness of normalization by comparing feature variability
(measured as \%CV) in QC and/or study samples before and after normalization.
The comparison is visualized through one of three plot types:
\itemize{
\item Scatter plot: CV values before vs after normalization
\item Difference plot: (CV after - CV before) vs mean CV
\item Ratio plot: log2 of (CV after / CV before) vs mean CV
}

Features can be grouped and visualized by their fature class using facets.

The resulting visualization helps assess whether normalization improved measurement
precision across different features and sample/QC types.
}
\details{
The function preselects the corresponding variables from the QC metrics and uses
\code{\link[=plot_qcmetrics_comparison]{plot_qcmetrics_comparison()}} to visualize the results.
\itemize{
\item The data must be normalized before using \code{\link[=normalize_by_istd]{normalize_by_istd()}} followed by
calculation of the QC metrics table via \code{\link[=calc_qc_metrics]{calc_qc_metrics()}} or
\code{\link[=filter_features_qc]{filter_features_qc()}}, see examples below.
\item When \code{facet_by_class = TRUE}, then the \code{feature_class} must be defined in the
metadata or retrieved via specific functions, e.g., \code{\link[=parse_lipid_feature_names]{parse_lipid_feature_names()}}.
}
}
\examples{
# Example usage:
mexp <- lipidomics_dataset
mexp <- normalize_by_istd(mexp)
mexp <- calc_qc_metrics(mexp)
plot_normalization_qc(
  data = mexp,
  before_norm_var = "intensity",
  after_norm_var = "norm_intensity",
  plot_type = "scatter",
  qc_type = "SPL",
  filter_data = FALSE,
  facet_by_class = TRUE,
  cv_threshold_value = 25
)

}
\seealso{
\code{\link[=plot_qcmetrics_comparison]{plot_qcmetrics_comparison()}}, \code{\link[=calc_qc_metrics]{calc_qc_metrics()}}, \code{\link[=filter_features_qc]{filter_features_qc()}},
}
