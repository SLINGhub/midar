<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Drift Correction by Gaussian Kernel Smoothing — correct_drift_gaussiankernel • midar</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Drift Correction by Gaussian Kernel Smoothing — correct_drift_gaussiankernel"><meta name="description" content="Function to correct for run-order drifts within or across batches using gaussian kernel smoothing (see Tan et al. (2020)).
This is typically used to smooth based on the study samples. To avoid local biases and artefacts, this function should only be applied to analyses wit sufficient number of samples that were well randomized."><meta property="og:description" content="Function to correct for run-order drifts within or across batches using gaussian kernel smoothing (see Tan et al. (2020)).
This is typically used to smooth based on the study samples. To avoid local biases and artefacts, this function should only be applied to analyses wit sufficient number of samples that were well randomized."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">midar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getstarted.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Key Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/datastructure.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/midarexperiment.html">MidarExperiment</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data and Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/dataimport.html">Importing</a></li>
    <li><a class="dropdown-item" href="../articles/annotating.html">Annotating (Metadata)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/BatchDriftCorrect.html">Batch/Drift Correction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/updates.html">Updates</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SLINGhub/midar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Drift Correction by Gaussian Kernel Smoothing</h1>
      <small class="dont-index">Source: <a href="https://github.com/SLINGhub/midar/blob/HEAD/R/correct-drift-batch.R" class="external-link"><code>R/correct-drift-batch.R</code></a></small>
      <div class="d-none name"><code>correct_drift_gaussiankernel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to correct for run-order drifts within or across batches using gaussian kernel smoothing (see <em>Tan et al. (2020)</em>).
This is typically used to smooth based on the study samples. To avoid local biases and artefacts, this function should only be applied to analyses wit sufficient number of samples that were well randomized.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">correct_drift_gaussiankernel</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">variable</span>,</span>
<span>  <span class="va">reference_qc_types</span>,</span>
<span>  within_batch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  replace_previous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">kernel_size</span>,</span>
<span>  outlier_filter <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  outlier_ksd <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  location_smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale_smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log_transform_internal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  recalc_trend_after <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  conditional_correction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  feature_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_istd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cv_ratio_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use_original_if_fail <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>MidarExperiment object</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>The variable to be corrected for drift effects. Must be one of "intensity", "norm_intensity", or "conc"</p></dd>


<dt id="arg-reference-qc-types">reference_qc_types<a class="anchor" aria-label="anchor" href="#arg-reference-qc-types"></a></dt>
<dd><p>QC types used for drift correction. Typically includes the study samples (<code>SPL</code>).</p></dd>


<dt id="arg-within-batch">within_batch<a class="anchor" aria-label="anchor" href="#arg-within-batch"></a></dt>
<dd><p>Apply to each batch separately if <code>TRUE</code> (the default), or across all batches if <code>FALSE</code>.</p></dd>


<dt id="arg-replace-previous">replace_previous<a class="anchor" aria-label="anchor" href="#arg-replace-previous"></a></dt>
<dd><p>Logical. Replace previous correction (<code>TRUE</code>), or adds on top of previous correction (<code>FALSE</code>). Default is <code>TRUE</code>.</p></dd>


<dt id="arg-kernel-size">kernel_size<a class="anchor" aria-label="anchor" href="#arg-kernel-size"></a></dt>
<dd><p>Kernel bandwidth</p></dd>


<dt id="arg-outlier-filter">outlier_filter<a class="anchor" aria-label="anchor" href="#arg-outlier-filter"></a></dt>
<dd><p>Kernel Outlier filter</p></dd>


<dt id="arg-outlier-ksd">outlier_ksd<a class="anchor" aria-label="anchor" href="#arg-outlier-ksd"></a></dt>
<dd><p>Kernel K times standard deviation of data distribution</p></dd>


<dt id="arg-location-smooth">location_smooth<a class="anchor" aria-label="anchor" href="#arg-location-smooth"></a></dt>
<dd><p>Location parameter smoothing</p></dd>


<dt id="arg-scale-smooth">scale_smooth<a class="anchor" aria-label="anchor" href="#arg-scale-smooth"></a></dt>
<dd><p>Scale parameter smoothing</p></dd>


<dt id="arg-log-transform-internal">log_transform_internal<a class="anchor" aria-label="anchor" href="#arg-log-transform-internal"></a></dt>
<dd><p>Apply log transformation internally for smoothing if <code>TRUE</code> (default). This enhances robustness against outliers but does not affect the final data, which remains untransformed.</p></dd>


<dt id="arg-recalc-trend-after">recalc_trend_after<a class="anchor" aria-label="anchor" href="#arg-recalc-trend-after"></a></dt>
<dd><p>Recalculate trends after smoothing, used for plotting (e.g., in <code><a href="plot_runscatter.html">plot_runscatter()</a></code>)</p></dd>


<dt id="arg-conditional-correction">conditional_correction<a class="anchor" aria-label="anchor" href="#arg-conditional-correction"></a></dt>
<dd><p>Apply drift correction to all species if <code>TRUE</code>, or only when sample CV after smoothing changes below a threshold defined via <code>cv_ratio_threshold</code></p></dd>


<dt id="arg-feature-list">feature_list<a class="anchor" aria-label="anchor" href="#arg-feature-list"></a></dt>
<dd><p>Subset the features for correction whose names matches the specified text using regular expression. Default is <code>NULL</code> which means all features are selected.</p></dd>


<dt id="arg-ignore-istd">ignore_istd<a class="anchor" aria-label="anchor" href="#arg-ignore-istd"></a></dt>
<dd><p>Do not apply corrections to ISTDs</p></dd>


<dt id="arg-cv-ratio-threshold">cv_ratio_threshold<a class="anchor" aria-label="anchor" href="#arg-cv-ratio-threshold"></a></dt>
<dd><p>Only used when <code>conditional_correction = TRUE</code>. Maximum allowed ratio of sample CV change before and after smoothing for the correction to be applied.
A value of 1 (the default) indicates the CV needs to improve or remain unchanged after smoothing so that the conditional smoothing is applied. A value of &lt; 1 means that CV needs to improve, a value of e.g. 1.20 that the CV need to improve or get worse by max 1.20-fold after smoothing.</p></dd>


<dt id="arg-use-original-if-fail">use_original_if_fail<a class="anchor" aria-label="anchor" href="#arg-use-original-if-fail"></a></dt>
<dd><p>Determines the action when smoothing fails for a feature. If TRUE (default), the original data is used; if FALSE, the result for each analysis is NA.</p></dd>


<dt id="arg-show-progress">show_progress<a class="anchor" aria-label="anchor" href="#arg-show-progress"></a></dt>
<dd><p>Show progress bars. Set this to <code>FALSE</code> when rendering the notebook.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>MidarExperiment object</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Teo G., Chew WS, Burla B, Herr D, Tai ES, Wenk MR, Torta F, &amp; Choi H (2020). MRMkit: Automated Data Processing for Large-Scale Targeted Metabolomics Analysis. <em>Analytical Chemistry</em>, 92(20), 13677–13682. <a href="https://doi.org/10.1021/acs.analchem.0c03060" class="external-link">https://doi.org/10.1021/acs.analchem.0c03060</a></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bo Burla.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

