<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calibrate Features Values Using Reference Sample — calibrate_by_reference • midar</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibrate Features Values Using Reference Sample — calibrate_by_reference"><meta name="description" content="This function calibrates feature abundances based on a specified reference sample.
Calibration can be applied to the entire dataset using one or more reference samples,
or batch-wise using reference sample analyses present within each batch.
For both approaches, multiple measurements of the same reference sample are
summarized using either mean (default) or median (set by the summarize_fun argument)."><meta property="og:description" content="This function calibrates feature abundances based on a specified reference sample.
Calibration can be applied to the entire dataset using one or more reference samples,
or batch-wise using reference sample analyses present within each batch.
For both approaches, multiple measurements of the same reference sample are
summarized using either mean (default) or median (set by the summarize_fun argument)."><meta property="og:image" content="https://slinghub.github.io/midar/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">midar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/00_get_started.html">Getting started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials-recipes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials &amp; Recipes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials-recipes"><li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/T01_prepdata.html">Preparing and importing data</a></li>
    <li><a class="dropdown-item" href="../articles/T02_settingup_workflow.html">Setting Up a Basic MiDAR Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/T01_targetlipidomics_workflow.html">Targeted lipidomics with QC</a></li>
    <li><a class="dropdown-item" href="../articles/T_DriftCorrect.html">Drift Correction</a></li>
    <li><a class="dropdown-item" href="../articles/T_BatchCorrect.html">Batch Correction</a></li>
    <li><a class="dropdown-item" href="../articles/T_CalibRef.html">Calibration by a Reference Sample</a></li>
    <li><a class="dropdown-item" href="../articles/R01_quantms.html">External Calibration and QC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Recipes</h6></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-manual" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Manual</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-manual"><li><h6 class="dropdown-header" data-toc-skip>Key Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/01_datastructure.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/02_keydataids.html">Data Indentifier</a></li>
    <li><a class="dropdown-item" href="../articles/02b_keyfeaturevar.html">Feature Variables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data and Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/03_midarexperiment.html">MidarExperiment Object</a></li>
    <li><a class="dropdown-item" href="../articles/04_dataimport.html">Data Import</a></li>
    <li><a class="dropdown-item" href="../articles/05_metadataimport.html">Metadata Import</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/07_driftbatchcorr.html">Batch/Drift Correction</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SLINGhub/midar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calibrate Features Values Using Reference Sample</h1>
      <small class="dont-index">Source: <a href="https://github.com/SLINGhub/midar/blob/HEAD/R/calc-ref-normalization.R" class="external-link"><code>R/calc-ref-normalization.R</code></a></small>
      <div class="d-none name"><code>calibrate_by_reference.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calibrates feature abundances based on a specified reference sample.
Calibration can be applied to the entire dataset using one or more reference samples,
or batch-wise using reference sample analyses present within each batch.
For both approaches, multiple measurements of the same reference sample are
summarized using either <code>mean</code> (default) or <code>median</code> (set by the <code>summarize_fun</code> argument).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calibrate_by_reference</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">variable</span>,</span>
<span>  <span class="va">reference_sample_id</span>,</span>
<span>  <span class="va">absolute_calibration</span>,</span>
<span>  batch_wise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  summarize_fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  store_conc_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  undefined_conc_action <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  store_normalized <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>MidarExperiment</code> object containing the metabolomics data to be normalized</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>Character string indicating which data type to calibrate Must be
one of: "intensity", "norm_intensity", or "conc"</p></dd>


<dt id="arg-reference-sample-id">reference_sample_id<a class="anchor" aria-label="anchor" href="#arg-reference-sample-id"></a></dt>
<dd><p>Character vector specifying the sample ID(s) to use as
reference(s) or standards</p></dd>


<dt id="arg-absolute-calibration">absolute_calibration<a class="anchor" aria-label="anchor" href="#arg-absolute-calibration"></a></dt>
<dd><p>Logical indicating whether to perform absolute calibration using
known concentrations of the reference sample (TRUE) or relative calibration (FALSE).</p></dd>


<dt id="arg-batch-wise">batch_wise<a class="anchor" aria-label="anchor" href="#arg-batch-wise"></a></dt>
<dd><p>Logical indicating whether to perform calibration for each batch seperately (TRUE) or for all samples together (FALSE).</p></dd>


<dt id="arg-summarize-fun">summarize_fun<a class="anchor" aria-label="anchor" href="#arg-summarize-fun"></a></dt>
<dd><p>Either "mean" or "median". If <code>absolute_calibration = TRUE</code>,
this function is used to summarize the reference sample concentrations across analyses of specified <code>reference_sample_id</code>. Default is "mean".</p></dd>


<dt id="arg-store-conc-ratio">store_conc_ratio<a class="anchor" aria-label="anchor" href="#arg-store-conc-ratio"></a></dt>
<dd><p>Logical. Whether to store the ratio of measured
(non-calibrated) compared to the expected (known) concentrations. Only applied if <code>absolute_calibration = TRUE</code>.
This ratio is stored under the feature variable <code>feature_conc_ratio</code>. By default it is <code>TRUE</code> when <code>variable = 'conc', otherwise </code>FALSE`.</p></dd>


<dt id="arg-undefined-conc-action">undefined_conc_action<a class="anchor" aria-label="anchor" href="#arg-undefined-conc-action"></a></dt>
<dd><p>Character string specifying how to handle features
without defined concentrations in reference samples when <code>absolute_calibration = TRUE</code>.
Must be one of: "original" (keep original values), "na" (set to NA), or "error". Default is "keep".</p>
<p>Default is <code>TRUE</code>.</p></dd>


<dt id="arg-store-normalized">store_normalized<a class="anchor" aria-label="anchor" href="#arg-store-normalized"></a></dt>
<dd><p>Logical indicating whether to keep the normalized values in the dataset
when <code>absolute_calibration = TRUE</code>. Default is FALSE. These values are then stored
as <code>[VARIABLE]_normalized</code>, where <code>[VARIABLE]</code> is the input variable, e.g., <code>conc</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>MidarExperiment</code> object with calibrated data</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Calibration can be performed in two ways, either absolute, resulting in
concentrations, or relative, resulting in ratios:</p><ol><li><p>Absolute calibration (when <code>absolute_calibration = TRUE</code>)</p>
<p>Calibrates (or re-calibrates) feature abundances based on known concentrations of the corresponding features
defined for a reference sample. The calibrated concentration for a given analyte is calculated as:</p>
<p>$$c_\textrm{cal}^\textrm{Analyte} = \frac{c_\textrm{sample}^\textrm{Analyte}}{c_\textrm{ref}^\textrm{Analyte}} \times c_\textrm{known}^\textrm{Analyte}$$</p>
<p>The input variable can either <code>conc</code>, <code>norm_intensity</code>, or <code>intensity, whereas the result will always be stored under the variable</code>conc` (concentration), in the unit defined
for the feature concentrations in the reference sample.</p>
<p>Metadata requirements:</p><ul><li><p><code>sample_id</code> and <code>analyte_id</code> must be defined for the reference sample and features in the analysis and feature metadata, respectively.</p></li>
<li><p>Known analyte concentrations must be defined in the <code>QC concentration</code> metadata for the for the reference sample</p></li>
<li><p>An error will be raised  if no concentrations are defined for any features</p></li>
</ul><p>Missing analyte concentrations for the reference sample can be handed via <code>undefined_conc_handling</code> with following options:</p><ul><li><p><code>original</code>: Keep original feature values, i.e. the non-calibrated values will be returned. <em>Note</em>: this is only available when <code>variable = conc</code>. Use with caution to avoid mixing units.</p></li>
<li><p><code>na</code>: Set affected features values to <code>NA</code></p></li>
<li><p><code>error</code> (default): The function stops with error in case of any undefined reference sample feature concentration.</p></li>
<li><p>In case all feature concentrations are undefined, the function will stop with an error.</p></li>
</ul><p>The re-calibrated feature concentrations are stored as <code>conc</code>, overwriting existing <code>conc</code> values.
The original <code>conc</code> values are stored as <code>conc_beforecal</code>.</p>
<p>The ratio between the measured and expected (known) concentrations in the
reference sample is available via the feature variable <code>feature_conc_ratio</code>
and is calculated as follows:</p>
<p>$$c_\textrm{ratio}^\textrm{Analyte} = \frac{c_\textrm{measured}^\textrm{Analyte}}{c_\textrm{expected}^\textrm{Analyte}}$$</p>
<p>where \(c_\textrm{measured}\) is the measured (non-calibrated) concentration, and
\(c_\textrm{expected}\) is the known or reference concentration for the same analyte.
A bias value of 1 indicates perfect agreement; values above or below 1 indicate over- or underestimation.</p>
<p>To export the calibrated concentrations use <code><a href="save_dataset_csv.html">save_dataset_csv()</a></code> with <code>variable = "conc", or to export non-calibrated values with </code>variable = "conc_beforecal"<code>. When saving the MiDAR XLSX report, the calibrated concentrations will also be stored as </code>conc`.</p></li>
<li><p>Normalization (relative calibration, <code>absolute_calibration = FALSE</code>)</p>
<p>Normalizes features abundances with corresponding feature abundances in a reference sample,
resulting in ratios. Any available feature abundance variable
(i.e., <code>conc</code>, <code>norm_intensity</code>, or <code>intensity</code>) can be used as input. The normalization is calculate for all present features.
The resulting output will be stored as <code>[VARIABLE]_normalized</code>, whereby <code>[VARIABLE]</code> is the input variable, e.g., <code>conc_normalized</code>.</p>
<p>To export the normalized abundances , use <code><a href="save_dataset_csv.html">save_dataset_csv()</a></code> with <code>variable = "[VARIABLE]_normalized"</code>
For MiDAR XLSX report, use <code><a href="save_report_xlsx.html">save_report_xlsx()</a></code> with same variable setting as for <code><a href="save_dataset_csv.html">save_dataset_csv()</a></code> to
When saving the MiDAR XLSX report via <code><a href="save_report_xlsx.html">save_report_xlsx()</a></code>, availble unfiltered normalized feature abundances
will be included by default. To include filtered normalized feature abundances, set <code>filtered_variable = "[VARIABLE]_normalized"</code>.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="normalize_by_istd.html">normalize_by_istd()</a></code>, <code><a href="quantify_by_istd.html">quantify_by_istd()</a></code>, <code><a href="quantify_by_calibration.html">quantify_by_calibration()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat_file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"S1P_MHQuant.csv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">meta_file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"S1P_metadata_tables.xlsx"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Load data and metadata</span></span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_data_masshunter.html">import_data_masshunter</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="va">dat_file</span>, import_metadata <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Imported 65 analyses with 16 features</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">`feature_area` selected as default feature intensity. Modify with `set_intensity_var()`.</span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_metadata_analyses.html">import_metadata_analyses</a></span><span class="op">(</span><span class="va">mexp</span>, path <span class="op">=</span> <span class="va">meta_file</span>, sheet <span class="op">=</span> <span class="st">"Analyses"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Analysis metadata associated with 65 analyses.</span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_metadata_features.html">import_metadata_features</a></span><span class="op">(</span><span class="va">mexp</span>, path <span class="op">=</span> <span class="va">meta_file</span>, sheet <span class="op">=</span> <span class="st">"Features"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Analysis metadata associated with 65 analyses.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Feature metadata associated with 16 features.</span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_metadata_istds.html">import_metadata_istds</a></span><span class="op">(</span><span class="va">mexp</span>, path <span class="op">=</span> <span class="va">meta_file</span>, sheet <span class="op">=</span> <span class="st">"ISTDs"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Analysis metadata associated with 65 analyses.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Feature metadata associated with 16 features.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Internal Standard metadata associated with 2 ISTDs.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load known feature concentrations in the reference sample</span></span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_metadata_qcconcentrations.html">import_metadata_qcconcentrations</a></span><span class="op">(</span><span class="va">mexp</span>, path <span class="op">=</span> <span class="va">meta_file</span>, sheet <span class="op">=</span> <span class="st">"QCconcentrations"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Analysis metadata associated with 65 analyses.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Feature metadata associated with 16 features.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Internal Standard metadata associated with 2 ISTDs.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">QC concentration metadata associated with 1 annotated samples and 6 annotated analytes</span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="normalize_by_istd.html">normalize_by_istd</a></span><span class="op">(</span><span class="va">mexp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">Interfering features defined in metadata, but no correction was applied. Use `correct_interferences()` to correct.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">14 features normalized with 2 ISTDs in 65 analyses.</span></span>
<span class="r-in"><span><span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="quantify_by_istd.html">quantify_by_istd</a></span><span class="op">(</span><span class="va">mexp</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">14 feature concentrations calculated based on 2 ISTDs and sample amounts of 65 analyses.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> <span style="color: #00BB00;">Concentrations are given in μmol/L.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Absolute calibration</span></span></span>
<span class="r-in"><span><span class="co"># --------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu">calibrate_by_reference</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">mexp</span>,</span></span>
<span class="r-in"><span>    variable <span class="op">=</span> <span class="st">"conc"</span>,</span></span>
<span class="r-in"><span>    reference_sample_id <span class="op">=</span> <span class="st">"SRM1950"</span>,</span></span>
<span class="r-in"><span>    absolute_calibration <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    batch_wise <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    summarize_fun <span class="op">=</span> <span class="st">"mean"</span>,</span></span>
<span class="r-in"><span>    undefined_conc_action <span class="op">=</span> <span class="st">"original"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">One or more feature concentration are not defined in the reference sample SRM1950. Original values will be returned for these. To change this, modify `undefined_conc_action` argument.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">6 feature concentrations were re-calibrated using the reference sample SRM1950.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> <span style="color: #00BB00;">Concentrations are given in umol/L.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Export absolute calibration concentrations</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="save_dataset_csv.html">save_dataset_csv</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="st">"calibrated.csv"</span>, variable <span class="op">=</span> <span class="st">"conc"</span>, filter_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Concentration values for 65 analyses and 7 features have been exported to 'calibrated.csv'.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Export non-calibrated concentrations</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="save_dataset_csv.html">save_dataset_csv</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="st">"noncalibrated.csv"</span>, variable <span class="op">=</span> <span class="st">"conc_beforecal"</span>, filter_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Conc_beforecal values for 65 analyses and 16 features have been exported to 'noncalibrated.csv'.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Create XLSX report with calibrated concentrations as filtered dataset</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="save_report_xlsx.html">save_report_xlsx</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="st">"report.xlsx"</span>, filtered_variable <span class="op">=</span> <span class="st">"conc"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Saving report to disk - please wait...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">The data processing report has been saved to 'report.xlsx'.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Relative calibration</span></span></span>
<span class="r-in"><span><span class="co"># --------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu">calibrate_by_reference</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">mexp</span>,</span></span>
<span class="r-in"><span>    variable <span class="op">=</span> <span class="st">"conc"</span>,</span></span>
<span class="r-in"><span>    reference_sample_id <span class="op">=</span> <span class="st">"SRM1950"</span>,</span></span>
<span class="r-in"><span>    batch_wise <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    absolute_calibration <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">All features were normalized with reference sample SRM1950 features.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> <span style="color: #00BB00;">Unit is: sample [conc] / SRM1950 [conc]</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Export SRM1950-normalized concentrations</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="save_dataset_csv.html">save_dataset_csv</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="st">"normalized.csv"</span>, variable <span class="op">=</span> <span class="st">"conc_normalized"</span>, filter_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Conc_normalized values for 65 analyses and 16 features have been exported to 'normalized.csv'.</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Create XLSX report with SRM1950-normalized concentrations as filtered dataset</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="save_report_xlsx.html">save_report_xlsx</a></span><span class="op">(</span><span class="va">mexp</span>, <span class="st">"report.xlsx"</span>, filtered_variable <span class="op">=</span> <span class="st">"conc_normalized"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Saving report to disk - please wait...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">The data processing report has been saved to 'report.xlsx'.</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bo Burla.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

