<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Drift Correction by LOESS Smoothing — correct_drift_loess • midar</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Drift Correction by LOESS Smoothing — correct_drift_loess"><meta name="description" content="Function to correct for run-order drifts within or across batches using loess smoothing"><meta property="og:description" content="Function to correct for run-order drifts within or across batches using loess smoothing"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">midar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getstarted.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Key Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/datastructure.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/midarexperiment.html">MidarExperiment</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data and Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/dataimport.html">Importing</a></li>
    <li><a class="dropdown-item" href="../articles/annotating.html">Annotating (Metadata)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/BatchDriftCorrect.html">Batch/Drift Correction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/updates.html">Updates</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SLINGhub/midar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Drift Correction by LOESS Smoothing</h1>
      <small class="dont-index">Source: <a href="https://github.com/SLINGhub/midar/blob/HEAD/R/correct-drift-batch.R" class="external-link"><code>R/correct-drift-batch.R</code></a></small>
      <div class="d-none name"><code>correct_drift_loess.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to correct for run-order drifts within or across batches using loess smoothing</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">correct_drift_loess</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">variable</span>,</span>
<span>  <span class="va">reference_qc_types</span>,</span>
<span>  within_batch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  replace_previous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  span <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  conditional_correction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log_transform_internal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  feature_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_istd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cv_ratio_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use_original_if_fail <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extrapolate <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>MidarExperiment object</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>The variable to be corrected for drift effects. Must be one of "intensity", "norm_intensity", or "conc"</p></dd>


<dt id="arg-reference-qc-types">reference_qc_types<a class="anchor" aria-label="anchor" href="#arg-reference-qc-types"></a></dt>
<dd><p>QC types used for drift correction</p></dd>


<dt id="arg-within-batch">within_batch<a class="anchor" aria-label="anchor" href="#arg-within-batch"></a></dt>
<dd><p>Apply to each batch separately if <code>TRUE</code> (the default), or across all batches if <code>FALSE</code>.</p></dd>


<dt id="arg-replace-previous">replace_previous<a class="anchor" aria-label="anchor" href="#arg-replace-previous"></a></dt>
<dd><p>Logical. Replace previous correction (<code>TRUE</code>), or adds on top of previous correction (<code>FALSE</code>). Default is <code>TRUE</code>.</p></dd>


<dt id="arg-span">span<a class="anchor" aria-label="anchor" href="#arg-span"></a></dt>
<dd><p>Loess span width (default is 0.75)</p></dd>


<dt id="arg-conditional-correction">conditional_correction<a class="anchor" aria-label="anchor" href="#arg-conditional-correction"></a></dt>
<dd><p>Determines whether drift correction should be applied to all species unconditionally (<code>TRUE</code>) or only when the sample CV after smoothing is below the ratio threshold specified by <code>cv_ratio_threshold</code>.</p></dd>


<dt id="arg-log-transform-internal">log_transform_internal<a class="anchor" aria-label="anchor" href="#arg-log-transform-internal"></a></dt>
<dd><p>Log transform the data for correction when <code>TRUE</code> (the default). Note: log transformation is solely applied internally for smoothing, results will not be be log-transformed. Log transformation may result in more robust smoothing that is less sensitive to outlier.</p></dd>


<dt id="arg-feature-list">feature_list<a class="anchor" aria-label="anchor" href="#arg-feature-list"></a></dt>
<dd><p>Subset the features for correction whose names matches the specified text using regular expression. Default is <code>NULL</code> which means all features are selected.</p></dd>


<dt id="arg-ignore-istd">ignore_istd<a class="anchor" aria-label="anchor" href="#arg-ignore-istd"></a></dt>
<dd><p>Do not apply corrections to ISTDs</p></dd>


<dt id="arg-cv-ratio-threshold">cv_ratio_threshold<a class="anchor" aria-label="anchor" href="#arg-cv-ratio-threshold"></a></dt>
<dd><p>This parameter defines the maximum allowable change (ratio) in the coefficient of variation (CV) ratio of samples before and after smoothing for the correction to be applied.
A value of 1 (the default) requires the CV to improve, while a value above 1 allows the CV to improve, or to degrade by a maximum of the indicated fold-difference times post-smoothing.</p></dd>


<dt id="arg-use-original-if-fail">use_original_if_fail<a class="anchor" aria-label="anchor" href="#arg-use-original-if-fail"></a></dt>
<dd><p>Determines the action when smoothing fails for a feature. If TRUE (default), the original data is used; if FALSE, the result for each analysis is NA.</p></dd>


<dt id="arg-extrapolate">extrapolate<a class="anchor" aria-label="anchor" href="#arg-extrapolate"></a></dt>
<dd><p>Extrapolate loess smoothing. WARNING: It is generally not recommended to extrapolate outside of the range spanned by the QCs used for smoothing. See details below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>MidarExperiment object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that using extrapolation for loess smoothing is generally not recommended. Use this only if you must include samples or QCs that are outside of the range spanned by the QCs used for smoothing.
Cases where this may be necessary are when specific drifts occur in analysis sequence segments that are not spanned by QC, e.g. when the instrument broke down or suddenly changed its sensitivity.
Only use for samples  adjacent to the first or last QC and consult runscatter plots.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bo Burla.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

