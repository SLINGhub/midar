<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Importing analytical data • midar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Importing analytical data">
<meta name="description" content="MiDAR: postprocessing and quality control of small molecule mass spectrometry data
">
<meta property="og:description" content="MiDAR: postprocessing and quality control of small molecule mass spectrometry data
">
<meta property="og:image" content="https://slinghub.github.io/midar/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">midar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/00_get_started.html">Getting started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials-recipes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials &amp; Recipes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials-recipes">
<li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/T01_prepdata.html">Preparing and importing data</a></li>
    <li><a class="dropdown-item" href="../articles/T02_settingup_workflow.html">Setting Up a Basic MiDAR Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/T01_targetlipidomics_workflow.html">Targeted lipidomics with QC</a></li>
    <li><a class="dropdown-item" href="../articles/T_DriftCorrect.html">Drift Correction</a></li>
    <li><a class="dropdown-item" href="../articles/T_BatchCorrect.html">Batch Correction</a></li>
    <li><a class="dropdown-item" href="../articles/T_CalibRef.html">Calibration by a Reference Sample</a></li>
    <li><a class="dropdown-item" href="../articles/R01_quantms.html">External Calibration and QC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Recipes</h6></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-manual" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Manual</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-manual">
<li><h6 class="dropdown-header" data-toc-skip>Key Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/01_datastructure.html">Data Structures</a></li>
    <li><a class="dropdown-item" href="../articles/02_keydataids.html">Data Indentifier</a></li>
    <li><a class="dropdown-item" href="../articles/02b_keyfeaturevar.html">Feature Variables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data and Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/03_midarexperiment.html">MidarExperiment Object</a></li>
    <li><a class="dropdown-item" href="../articles/04_dataimport.html">Data Import</a></li>
    <li><a class="dropdown-item" href="../articles/05_metadataimport.html">Metadata Import</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/07_driftbatchcorr.html">Batch/Drift Correction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SLINGhub/midar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Importing analytical data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SLINGhub/midar/blob/HEAD/vignettes/articles/04_dataimport.Rmd" class="external-link"><code>vignettes/articles/04_dataimport.Rmd</code></a></small>
      <div class="d-none name"><code>04_dataimport.Rmd</code></div>
    </div>

    
    
<p>Analytical data, i.e. preprocessed data from mass spectrometry
experiments, can be imported from different sources.</p>
<p>Data files present in a folder can also be imported and merged as
well. This can be useful when the raw data processing is broken down in
batches resulting in separate result files.</p>
<div class="section level2">
<h2 id="data-sources">Data Sources<a class="anchor" aria-label="anchor" href="#data-sources"></a>
</h2>
<p>Following formats are currently supported:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Source</th>
<th>MiDAR function</th>
<th>Details</th>
<th>Extension</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Agilent MassHunter</td>
<td><code>import_data_massshunter()</code></td>
<td>Flat and nested tables from MassHunter Quant.</td>
<td>.csv</td>
</tr>
<tr class="even">
<td>MRMkit</td>
<td><code><a href="../reference/import_data_mrmkit.html">import_data_mrmkit()</a></code></td>
<td>Long format output format</td>
<td>.csv or .tsv</td>
</tr>
<tr class="odd">
<td>Skyline</td>
<td><code><a href="../reference/import_data_skyline.html">import_data_skyline()</a></code></td>
<td>Skyline Small Molecule Transition Results (long format)</td>
<td></td>
</tr>
<tr class="even">
<td>Generic wide CSV</td>
<td><code><a href="../reference/import_data_csv_wide.html">import_data_csv_wide()</a></code></td>
<td>Samples/analyses as rows and features as columns. Can contain
columns specific sample annotations.</td>
<td>.csv</td>
</tr>
<tr class="odd">
<td>Generic long CSV</td>
<td><code><a href="../reference/import_data_csv_long.html">import_data_csv_long()</a></code></td>
<td>Long-format table with each row being a unique
<code>analysis_id</code> and <code>feature_id</code> pair and addtional
columns representing feature variables and sample/method
information</td>
<td>.csv</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="metadata-within-analytical-results">Metadata within analytical results<a class="anchor" aria-label="anchor" href="#metadata-within-analytical-results"></a>
</h2>
<p>When the analytical results contain metadata, such as sample and
feature annotations, these can be imported as metadata in the
<code>MidarExperiment</code> object as well. The imported metadata is
checked for integrity and consistency (see TODO) and then added to the
annotation tables within the <code>MidarExperiment</code>. To include
available metadata, set the argument
<code>import_metadata = TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="mrmkit">MRMkit<a class="anchor" aria-label="anchor" href="#mrmkit"></a>
</h2>
<p>Output files from <a href="https://github.com/MRMkit/MRMkit" title="https://github.com/MRMkit/MRMkit" class="external-link">MRMkit</a>, an open-source peak
integration software for MRM data () can imported directly. Specific
metadata present in the data file can be imported as well
(`import_metadata = TRUE`)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SLINGhub/midar" class="external-link">midar</a></span><span class="op">)</span></span>
<span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/MRMkit_demo.tsv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data_mrmkit.html">import_data_mrmkit</a></span><span class="op">(</span><span class="va">myexp</span>, <span class="va">filepath</span>, import_metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="agilent-masshunter-quantitative">Agilent MassHunter Quantitative<a class="anchor" aria-label="anchor" href="#agilent-masshunter-quantitative"></a>
</h2>
<p>Peak integration results exported from Agilent Masshunter Quant in
the CSV format can be imported. Samples must be present in rows,
features as columns. Import of qualifier results is supported. Sample,
method and result metadata present in the files can also be imported
(`import_metadata = TRUE`)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/MHQuant_demo.csv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data_masshunter.html">import_data_masshunter</a></span><span class="op">(</span><span class="va">myexp</span>, <span class="va">filepath</span>, import_metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="skyline-molecule-transition-results">Skyline Molecule Transition Results<a class="anchor" aria-label="anchor" href="#skyline-molecule-transition-results"></a>
</h2>
<p>Small molecule peak integration results from <a href="#id_0">Skyline</a> can be imported using long-format CSV reports.
To uniquely define <code>feature_id</code>s, the CSV file must include
the <code>Molecule Name</code> along with either the corresponding
precursor and product m/z values, or their names. The
<code>analysis_id</code> is mapped from the <code>Replicate Name</code>
column, which must also be present in the CSV file.</p>
<p>During the import process, unique <code>feature_id</code>s are
generated by appending either the precursor/product names or m/z values
to the <code>Molecule Name</code>, unless the <code>Molecule Name</code>
alone uniquely identifies the features. This behavior is controlled by
the <code>transition_id_columns</code> argument described below. Sample,
method, and result metadata present in the files can also be imported by
setting <code>import_metadata = TRUE</code>. For more details, refer to
the documentation of the <code><a href="../reference/import_data_skyline.html">import_data_skyline()</a></code>
function.</p>
<p>To export results from Skyline: Navigate to “File” &gt; “Export” and
select ‘Molecule Transition Results’ format. Ensure your export includes
<code>Replicate Name</code>, <code>Molecule Name</code>, and either
<code>Precursor Mz</code> and <code>Product Mz,</code> or
<code>Precursor Name</code> and <code>Product Name</code>. Also, export
at least one feature variable like <code>Area</code> or
<code>Retention Time (RT)</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/Skyline_MoleculeTransitionResults.csv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data_skyline.html">import_data_skyline</a></span><span class="op">(</span><span class="va">myexp</span>, </span>
<span>                             <span class="va">filepath</span>, </span>
<span>                             import_metadata <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             transition_id_columns <span class="op">=</span> <span class="st">"mz"</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generic-wide-format-csv-files">Generic Wide-Format CSV files<a class="anchor" aria-label="anchor" href="#generic-wide-format-csv-files"></a>
</h2>
<p>Analysis results, whether raw intensities (e.g., peak areas) or
preprocessed data (e.g., concentrations), can be provided as plain
wide-format CSV tables. In these tables, analyses (samples) should be
arranged in rows, and features in columns. The specific data type in the
table (e.g., area or concentration) is defined using the
<code>variable_name</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/plain_wide_dataset.csv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myexp</span> <span class="op">&lt;-</span> <span class="fu">midar</span><span class="fu">::</span><span class="fu"><a href="../reference/import_data_csv_wide.html">import_data_csv_wide</a></span><span class="op">(</span></span>
<span>  <span class="va">myexp</span>, </span>
<span>  path <span class="op">=</span> <span class="va">filepath</span>,</span>
<span>  variable_name <span class="op">=</span> <span class="st">"area"</span>, </span>
<span>  import_metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generic-long-format-csv-files">Generic Long-Format CSV Files<a class="anchor" aria-label="anchor" href="#generic-long-format-csv-files"></a>
</h2>
<p>Analysis results containing various feature variables (e.g., peak
areas, retention times) can be provided as generic long-format CSV
tables. In this format, each row represents a unique observation of a
feature-value pair for a given sample, while additional columns capture
feature variables as well as sample- or method-related metadata.</p>
<p>This long-format structure is a common export format supported by
many vendor and open-source software tools for both targeted and
untargeted raw data processing.</p>
<p>By default, the CSV file must include at least the following columns:
<code>analysis_id</code>, <code>feature_id</code>, and one feature
variable column such as <code>area</code>. Additional metadata and
feature variable columns are also supported — please refer to the
documentation for <code><a href="../reference/import_data_csv_long.html">import_data_csv_long()</a></code> for further
details.</p>
<p>If your CSV file uses different column names, you can import it by
specifying a column name mapping. This mapping associates the MiDAR
expected column names with the corresponding column names in your CSV
file (refer to the MiDAR Manual for details).</p>
<p>The column mapping is defined as a named vector, where the names
correspond to the MiDAR column names and the values correspond to the
column names in your CSV.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"plain_long_dataset.csv"</span>, package <span class="op">=</span> <span class="st">"midar"</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MidarExperiment.html">MidarExperiment</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a column mapping, right side is the column name in the CSV file</span></span>
<span><span class="va">col_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"analysis_id"</span> <span class="op">=</span> <span class="st">"raw_data_filename"</span>,</span>
<span>  <span class="st">"qc_type"</span> <span class="op">=</span> <span class="st">"qc_type"</span>,</span>
<span>  <span class="st">"feature_id"</span> <span class="op">=</span> <span class="st">"feature_id"</span>,</span>
<span>  <span class="st">"feature_class"</span> <span class="op">=</span> <span class="st">"feature_class"</span>,</span>
<span>  <span class="st">"istd_feature_id"</span> <span class="op">=</span> <span class="st">"istd_feature_id"</span>,</span>
<span>  <span class="st">"qc_type"</span> <span class="op">=</span> <span class="st">"qc_type"</span>,</span>
<span>  <span class="st">"feature_rt"</span> <span class="op">=</span> <span class="st">"rt"</span>,</span>
<span>  <span class="st">"feature_area"</span> <span class="op">=</span> <span class="st">"area"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import data</span></span>
<span> <span class="va">mexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data_csv_long.html">import_data_csv_long</a></span><span class="op">(</span></span>
<span>   data <span class="op">=</span> <span class="va">mexp</span>,</span>
<span>   path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>   column_mapping <span class="op">=</span> <span class="va">col_map</span>,</span>
<span>   import_metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multiple-files-import-and-merging">Multiple files Import and Merging<a class="anchor" aria-label="anchor" href="#multiple-files-import-and-merging"></a>
</h2>
<p>Multiple data files can be imported and merged. Users can either
provide a list of file paths or specify a folder path to import all data
files within that directory. This support for multiple files is useful
when raw data processing is divided into batches, leading to separate
result files.</p>
<p>The imported merged data is checked for consistency, ensuring that
each analysis ID and feature ID pair is unique. This means that the same
feature cannot be reported multiple times within the same analysis,
which can happend for example if the same feature in the same sample was
integrated in different raw data processing batches.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bo Burla.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
